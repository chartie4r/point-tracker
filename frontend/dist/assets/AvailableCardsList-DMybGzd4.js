import{_ as H,m as o,c as n,t,n as J,j as _,i as v,p as Q,o as W,a,g as c,w as N,v as T,F as B,r as D,b as p,h as Z,d as R,e as L,f as F,k as ee}from"./index-DSVxf6YR.js";import{a as te,s as ae,r as se}from"./client-Q6rv365W.js";import{B as le,a as oe,P as ne,p as P}from"./constants-ojXraNb3.js";const re=["AMEX","BMO","BNC","CIBC","RBC","Scotia","TD"];function I(u){if(!u)return null;const d=re.find(m=>m===u);return d?`/logos/banks/${encodeURIComponent(d)}.svg`:null}function ie(u){return u?u.length>=2?u.slice(0,2):u:"?"}function de(u){if(!u)return null;const d=String(u).toLowerCase().replace(/\s/g,"");return d==="visa"||d==="mastercard"||d==="amex"?`/logos/cards/${d}.svg`:null}const ue=["title"],ce=["src","alt"],ve={key:1,class:"card-network-logo__fallback"},me={__name:"CardNetworkLogo",props:{type:{type:String,default:""}},setup(u){const d=u,m=_(()=>(d.type||"").toLowerCase().replace(/\s/g,"")),b=_(()=>de(d.type)),y=v(!1);return(g,f)=>(o(),n("span",{class:J(["card-network-logo",[`card-network-logo--${m.value}`]]),title:u.type},[b.value&&!y.value?(o(),n("img",{key:0,src:b.value,alt:u.type||"Card network",class:"card-network-logo__img",onError:f[0]||(f[0]=C=>y.value=!0)},null,40,ce)):(o(),n("span",ve,t(u.type?String(u.type).slice(0,1):"?"),1))],10,ue))}},pe=H(me,[["__scopeId","data-v-3fa1ad96"]]),fe={class:"w-full"},be={class:"text-2xl font-semibold text-slate-900"},he={class:"mt-1 text-slate-600"},ye={class:"mt-4 flex flex-wrap items-center gap-3"},ge=["disabled"],_e=["disabled"],Ce={key:0,class:"text-sm text-slate-500"},we={key:1,class:"w-full text-sm text-emerald-600"},xe={key:0,class:"mt-4 text-slate-600"},ke={key:1,class:"mt-4 text-sm text-red-600"},$e={key:2,class:"mt-4 flex flex-wrap items-center gap-2"},Ve={value:""},Ye=["value"],Ne={value:""},Te=["value"],Be={value:""},De=["value"],Se={class:"text-sm text-slate-500"},Ae={value:""},Me={value:"valueY1Desc"},Re={value:"valueY1Asc"},Le={key:3,class:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3"},Pe={class:"mb-2 flex items-center justify-between"},Ue=["title"],je=["src","alt"],Fe={key:1,class:"text-xs font-bold text-slate-500"},Ie={class:"text-slate-900"},Oe={class:"text-sm text-slate-500"},Ee={class:"mt-1 flex flex-wrap gap-x-4 gap-y-0 text-sm"},Ke={key:0,class:"font-semibold text-emerald-600"},ze={key:1,class:"text-slate-700"},Ge={class:"mt-3 flex flex-wrap gap-2"},Xe=["onClick"],qe=["disabled","onClick"],He={key:4,class:"mt-4 text-slate-600"},Je={key:5,class:"mt-6 flex items-center justify-center gap-3"},Qe=["disabled"],We={class:"text-sm text-slate-600"},Ze=["disabled"],et={class:"max-h-[90vh] w-full max-w-lg overflow-y-auto rounded-xl bg-white p-6 shadow-xl ring-1 ring-slate-200"},tt={class:"mb-4 text-lg font-semibold text-slate-900"},at={class:"space-y-2 text-sm"},st={class:"font-medium text-slate-500"},lt={class:"text-slate-900"},ot={class:"font-medium text-slate-500"},nt={class:"text-slate-900"},rt={class:"font-medium text-slate-500"},it={class:"text-slate-900"},dt={class:"font-medium text-slate-500"},ut={class:"text-slate-900"},ct={class:"font-medium text-slate-500"},vt={class:"text-slate-900"},mt={key:0},pt={class:"font-medium text-slate-500"},ft={class:"text-slate-900"},bt={key:0},ht={key:1},yt={key:0},gt={key:1},_t={class:"font-medium text-slate-500"},Ct={class:"text-slate-900"},wt={key:2},xt={class:"font-medium text-slate-500"},kt={class:"whitespace-pre-line text-slate-700"},$t={key:3},Vt=["href"],Yt={class:"mt-6 flex justify-end gap-2"},U=30,Dt={__name:"AvailableCardsList",setup(u){const d=v(!0),m=v(null),b=v([]),y=v(null),g=v(!1),f=v(""),C=v(null),r=v(null),w=v(""),x=v(""),k=v(""),$=v(""),h=v(1),O=_(()=>{let e=b.value;return w.value&&(e=e.filter(l=>l.bank===w.value)),x.value&&(e=e.filter(l=>l.type===x.value)),k.value&&(e=e.filter(l=>l.pointsType===k.value)),e}),V=_(()=>{const e=[...O.value];return $.value==="valueY1Desc"?e.sort((l,i)=>(i.welcomeValueY1??-1)-(l.welcomeValueY1??-1)):$.value==="valueY1Asc"?e.sort((l,i)=>(l.welcomeValueY1??1e9)-(i.welcomeValueY1??1e9)):e.sort((l,i)=>(l.cardName||"").localeCompare(i.cardName||"")),e}),S=_(()=>V.value.length?Math.ceil(V.value.length/U):1),E=_(()=>{const e=(h.value-1)*U;return V.value.slice(e,e+U)});Q([w,x,k,$],()=>{h.value=1});function K(e){return`${e.cardName}-${e.bank}-${e.type}`}function j(e){return{cardName:e.cardName,type:e.type,status:"To_Open",pointsType:e.pointsType,bank:e.bank,annualCost:e.annualCost??null}}function z(e){r.value=e}function A(){r.value=null}async function M(){var e,l;d.value=!0,m.value=null;try{const i=await te();b.value=i.cards??[],y.value=i.lastRefreshedAt??null}catch(i){m.value=((l=(e=i.response)==null?void 0:e.data)==null?void 0:l.error)||i.message}finally{d.value=!1}}function G(e){if(!e)return"";const l=new Date(e);return new Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short"}).format(l)}async function X(){var e,l;console.log("[AvailableCards] Refresh all cards: starting (fire-and-forget)…"),g.value=!0,m.value=null,f.value="";try{const i=await ae();i.accepted?(f.value=i.message||"Refresh started in the background. Reload the list in a few minutes.",console.log("[AvailableCards] Refresh all cards: accepted, background job started"),setTimeout(()=>{f.value=""},8e3)):await M()}catch(i){const s=((l=(e=i.response)==null?void 0:e.data)==null?void 0:l.error)||i.message;console.error("[AvailableCards] Refresh all cards: error",s),m.value=s}finally{g.value=!1}}async function q(e){var l,i;C.value=e.id;try{const s=await se(e.id);b.value=b.value.map(Y=>Y.id===s.id?s:Y)}catch(s){alert(((i=(l=s.response)==null?void 0:l.data)==null?void 0:i.error)||s.message)}finally{C.value=null}}return W(M),(e,l)=>{const i=ee("router-link");return o(),n("div",fe,[a("h1",be,t(e.$t("availableCards.title")),1),a("p",he,t(e.$t("availableCards.intro")),1),a("div",ye,[a("button",{type:"button",class:"rounded-md bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 disabled:opacity-50",disabled:g.value||d.value,onClick:X},t(g.value?e.$t("availableCards.refreshingFromMilesopedia"):e.$t("availableCards.refreshFromMilesopedia")),9,ge),a("button",{type:"button",class:"rounded-md bg-white px-4 py-2 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:d.value,onClick:M},t(e.$t("availableCards.reloadList")),9,_e),y.value?(o(),n("span",Ce,t(e.$t("availableCards.lastRefreshed"))+": "+t(G(y.value)),1)):c("",!0),f.value?(o(),n("p",we,t(f.value),1)):c("",!0)]),d.value?(o(),n("p",xe,t(e.$t("availableCards.loading")),1)):m.value?(o(),n("p",ke,t(m.value),1)):(o(),n("div",$e,[N(a("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>w.value=s),class:"rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm py-1.5 pl-2 pr-8"},[a("option",Ve,t(e.$t("availableCards.allBanks")),1),(o(!0),n(B,null,D(p(le),s=>(o(),n("option",{key:s,value:s},t(s),9,Ye))),128))],512),[[T,w.value]]),N(a("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>x.value=s),class:"rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm py-1.5 pl-2 pr-8"},[a("option",Ne,t(e.$t("availableCards.allTypes")),1),(o(!0),n(B,null,D(p(oe),s=>(o(),n("option",{key:s,value:s},t(s),9,Te))),128))],512),[[T,x.value]]),N(a("select",{"onUpdate:modelValue":l[2]||(l[2]=s=>k.value=s),class:"rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm py-1.5 pl-2 pr-8"},[a("option",Be,t(e.$t("availableCards.allPointTypes")),1),(o(!0),n(B,null,D(p(ne),s=>(o(),n("option",{key:s,value:s},t(p(P)(s)),9,De))),128))],512),[[T,k.value]]),a("span",Se,t(e.$t("availableCards.sortBy")),1),N(a("select",{"onUpdate:modelValue":l[3]||(l[3]=s=>$.value=s),class:"min-w-[12rem] rounded-md border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm py-1.5 pl-2 pr-8"},[a("option",Ae,t(e.$t("availableCards.sortByName")),1),a("option",Me,t(e.$t("availableCards.sortByValueY1Desc")),1),a("option",Re,t(e.$t("availableCards.sortByValueY1Asc")),1)],512),[[T,$.value]])])),!d.value&&!m.value?(o(),n("ul",Le,[(o(!0),n(B,null,D(E.value,s=>(o(),n("li",{key:K(s),class:"flex flex-col rounded-xl bg-white p-4 shadow-sm ring-1 ring-slate-200"},[a("div",Pe,[a("div",{class:"h-8 w-12 overflow-hidden rounded-md bg-slate-100 flex items-center justify-center flex-shrink-0",title:s.bank},[p(I)(s.bank)?(o(),n("img",{key:0,src:p(I)(s.bank),alt:s.bank,class:"h-full w-full object-contain"},null,8,je)):(o(),n("span",Fe,t(p(ie)(s.bank)),1))],8,Ue),L(pe,{type:s.type},null,8,["type"])]),a("strong",Ie,t(s.cardName),1),a("span",Oe,t(s.bank)+" · "+t(s.type)+" · "+t(p(P)(s.pointsType)),1),a("div",Ee,[s.welcomeValueY1!=null?(o(),n("span",Ke,t(e.$t("availableCards.valueFirstYear"))+": $"+t(s.welcomeValueY1),1)):c("",!0),s.annualCost!=null?(o(),n("span",ze,"$"+t(s.annualCost)+t(e.$t("availableCards.perYear")),1)):c("",!0)]),a("div",Ge,[a("button",{type:"button",class:"rounded-md bg-white px-2.5 py-1 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50",onClick:Y=>z(s)},t(e.$t("availableCards.details")),9,Xe),L(i,{to:{name:"CardNew",state:{prefill:j(s)}},class:"rounded-md bg-primary-600 px-2.5 py-1 text-sm font-medium text-white hover:bg-primary-700"},{default:F(()=>[R(t(e.$t("availableCards.addToMyCards")),1)]),_:1},8,["to"]),a("button",{type:"button",class:"rounded-md bg-white px-2.5 py-1 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:C.value===s.id||g.value||d.value,onClick:Y=>q(s)},t(C.value===s.id?e.$t("availableCards.refreshing"):e.$t("availableCards.refresh")),9,qe)])]))),128))])):c("",!0),!d.value&&!m.value&&V.value.length===0?(o(),n("p",He,t(e.$t("availableCards.noMatch")),1)):c("",!0),S.value>1&&!d.value&&!m.value&&V.value.length>0?(o(),n("div",Je,[a("button",{type:"button",class:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:h.value===1,onClick:l[4]||(l[4]=s=>h.value--)},t(e.$t("availableCards.prev")),9,Qe),a("span",We,t(e.$t("availableCards.page"))+" "+t(h.value)+" / "+t(S.value),1),a("button",{type:"button",class:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:h.value===S.value,onClick:l[5]||(l[5]=s=>h.value++)},t(e.$t("availableCards.next")),9,Ze)])):c("",!0),r.value?(o(),n("div",{key:6,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 p-4",onClick:Z(A,["self"])},[a("div",et,[a("h2",tt,t(e.$t("availableCards.cardDetails")),1),a("dl",at,[a("div",null,[a("dt",st,t(e.$t("availableCards.name")),1),a("dd",lt,t(r.value.cardName),1)]),a("div",null,[a("dt",ot,t(e.$t("availableCards.bank")),1),a("dd",nt,t(r.value.bank),1)]),a("div",null,[a("dt",rt,t(e.$t("availableCards.type")),1),a("dd",it,t(r.value.type),1)]),a("div",null,[a("dt",dt,t(e.$t("availableCards.pointsType")),1),a("dd",ut,t(p(P)(r.value.pointsType)),1)]),a("div",null,[a("dt",ct,t(e.$t("availableCards.annualCost")),1),a("dd",vt,t(r.value.annualCost!=null?`$${r.value.annualCost}`:e.$t("availableCards.na")),1)]),r.value.welcomeValueY1!=null||r.value.welcomeValueY2!=null?(o(),n("div",mt,[a("dt",pt,t(e.$t("availableCards.welcomeBonusValue")),1),a("dd",ft,[r.value.welcomeValueY1!=null?(o(),n("span",bt,t(e.$t("availableCards.year1"))+": $"+t(r.value.welcomeValueY1),1)):c("",!0),r.value.welcomeValueY2!=null?(o(),n("span",ht,[r.value.welcomeValueY1!=null?(o(),n("span",yt," | ")):c("",!0),R(t(e.$t("availableCards.years2Plus"))+": $"+t(r.value.welcomeValueY2),1)])):c("",!0)])])):c("",!0),r.value.minSpend!=null?(o(),n("div",gt,[a("dt",_t,t(e.$t("availableCards.minimumSpend")),1),a("dd",Ct,"$"+t(r.value.minSpend),1)])):c("",!0),r.value.bonusDetails?(o(),n("div",wt,[a("dt",xt,t(e.$t("availableCards.bonusDetails")),1),a("dd",kt,t(r.value.bonusDetails),1)])):c("",!0),r.value.milesopediaUrl?(o(),n("div",$t,[l[6]||(l[6]=a("dt",{class:"font-medium text-slate-500"},"Milesopedia",-1)),a("dd",null,[a("a",{href:r.value.milesopediaUrl,target:"_blank",rel:"noopener noreferrer",class:"font-medium text-primary-600 hover:text-primary-700"},t(e.$t("availableCards.openCardPage")),9,Vt)])])):c("",!0)]),a("div",Yt,[a("button",{type:"button",class:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50",onClick:A},t(e.$t("availableCards.close")),1),L(i,{to:{name:"CardNew",state:{prefill:j(r.value)}},class:"rounded-md bg-primary-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-primary-700",onClick:A},{default:F(()=>[R(t(e.$t("availableCards.addToMyCards")),1)]),_:1},8,["to"])])])])):c("",!0)])}}};export{Dt as default};
