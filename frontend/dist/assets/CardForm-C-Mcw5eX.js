import{o as R,p as O,c as r,a as l,t as a,b as m,g as C,h as A,w as d,q as u,v as x,F as p,r as b,s as q,j as P,i as c,x as B,l as E,m as n}from"./index-DSVxf6YR.js";import{b as I,c as j,s as L,u as Y,e as K}from"./client-Q6rv365W.js";import{a as z,C as G,P as H,B as J,p as Q}from"./constants-ojXraNb3.js";const W={class:"max-w-2xl"},X={class:"mb-6 flex items-center justify-between gap-4"},Z={class:"text-2xl font-semibold text-slate-900"},ee=["disabled"],se={key:0,class:"mb-4 text-sm text-red-600"},te={class:"rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},le={class:"mb-1 block text-sm font-medium text-slate-700"},oe={class:"rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},ae={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},re={class:"mb-1 block text-sm font-medium text-slate-700"},ne=["value"],de={class:"mb-1 block text-sm font-medium text-slate-700"},ie=["value"],ue={class:"mb-1 block text-sm font-medium text-slate-700"},me=["value"],pe={class:"mb-1 block text-sm font-medium text-slate-700"},be=["value"],ce={class:"rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},ye={class:"mb-1 block text-sm font-medium text-slate-700"},ge={class:"mb-1 block text-sm font-medium text-slate-700"},ve={class:"mb-1 block text-sm font-medium text-slate-700"},xe={class:"mb-1 block text-sm font-medium text-slate-700"},he={class:"mb-1 block text-sm font-medium text-slate-700"},we={class:"rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},ke={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Ce={class:"mb-1 block text-sm font-medium text-slate-700"},De={class:"mb-1 block text-sm font-medium text-slate-700"},Fe={class:"mb-1 block text-sm font-medium text-slate-700"},$e={class:"mb-1 block text-sm font-medium text-slate-700"},Ve={class:"rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},_e={class:"mb-1 block text-sm font-medium text-slate-700"},Te={class:"flex gap-3"},Ue=["disabled"],Se={key:2,class:"mt-8 rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},Ne={class:"mb-2 text-lg font-semibold text-slate-900"},Me={class:"mb-4 text-sm text-slate-600"},Re=["disabled"],Oe={key:0,class:"mt-4"},Ae={class:"mb-2 text-sm font-medium text-slate-700"},qe={class:"space-y-1"},Pe=["onClick"],Le={__name:"CardForm",props:{id:{type:String,default:null}},setup($){const V=$,D=q(),_=E(),i=V.id??D.params.id,f=c(null),h=c(!1),y=c(!1),g=c(!1),v=c([]),e=B({cardName:"",type:"VISA",status:"To_Open",pointsType:"Aeroplan",bank:"TD",lineOfCredit:null,openDate:null,closeDate:null,possibleReopenDate:null,annualCost:null,progression:null,expenses:null,deadline:null,pointsValue:null,pointsDetails:null,milesopediaUrl:null,milesopediaSlug:null});function w(t){e.cardName=t.cardName??"",e.type=t.type??"VISA",e.status=t.status??"To_Open",e.pointsType=t.pointsType??"Aeroplan",e.bank=t.bank??"TD",e.lineOfCredit=t.lineOfCredit??null,e.openDate=t.openDate??null,e.closeDate=t.closeDate??null,e.possibleReopenDate=t.possibleReopenDate??null,e.annualCost=t.annualCost??null,e.progression=t.progression??null,e.expenses=t.expenses??null,e.deadline=t.deadline??null,e.pointsValue=t.pointsValue??null,e.pointsDetails=t.pointsDetails??null,e.milesopediaUrl=t.milesopediaUrl??null,e.milesopediaSlug=t.milesopediaSlug??null}function F(){return{cardName:e.cardName,type:e.type,status:e.status,pointsType:e.pointsType,bank:e.bank,lineOfCredit:e.lineOfCredit??void 0,openDate:e.openDate||void 0,closeDate:e.closeDate||void 0,possibleReopenDate:e.possibleReopenDate||void 0,annualCost:e.annualCost??void 0,progression:e.progression??void 0,expenses:e.expenses??void 0,deadline:e.deadline||void 0,pointsValue:e.pointsValue??void 0,pointsDetails:e.pointsDetails||void 0,milesopediaUrl:e.milesopediaUrl||void 0,milesopediaSlug:e.milesopediaSlug||void 0}}async function k(){var t,o;if(i){f.value=null;try{const s=await I(i);w(s)}catch(s){f.value=((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||s.message}}}async function T(){var t,o;h.value=!0;try{if(i)await Y(i,F()),await k();else{const s=await K(F());_.push(`/cards/${s.id}`)}}catch(s){alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||s.message)}finally{h.value=!1}}async function U(){var t,o;y.value=!0,v.value=[];try{v.value=await L()}catch(s){alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||s.message)}finally{y.value=!1}}function S(t){e.cardName=t.cardName??e.cardName,e.type=t.type??e.type,e.pointsType=t.pointsType??e.pointsType,e.bank=t.bank??e.bank,e.annualCost=t.annualCost??e.annualCost,e.milesopediaUrl=t.milesopediaUrl??null,e.milesopediaSlug=t.milesopediaSlug??null}const N=P(()=>!!e.milesopediaUrl||!!e.milesopediaSlug);async function M(){var t,o;if(i){g.value=!0;try{const s=await j(i);w(s)}catch(s){alert(((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||s.message)}finally{g.value=!1}}}return R(()=>{var t;!i&&((t=history.state)!=null&&t.prefill)?w(history.state.prefill):i&&k()}),O(()=>D.params.id,k),(t,o)=>(n(),r("div",W,[l("div",X,[l("h1",Z,a(m(i)?t.$t("cardForm.editCard"):t.$t("cardForm.newCard")),1),m(i)&&N.value?(n(),r("button",{key:0,type:"button",class:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:g.value,onClick:M},a(g.value?t.$t("cardForm.refreshingFromMilesopedia"):t.$t("cardForm.refreshFromMilesopedia")),9,ee)):C("",!0)]),f.value?(n(),r("p",se,a(f.value),1)):(n(),r("form",{key:1,onSubmit:A(T,["prevent"]),class:"space-y-6"},[l("div",te,[l("label",le,a(t.$t("cardForm.cardName")),1),d(l("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>e.cardName=s),type:"text",required:"",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.cardName]])]),l("div",oe,[o[16]||(o[16]=l("h2",{class:"mb-4 text-sm font-semibold text-slate-900"},"Type & statut",-1)),l("div",ae,[l("div",null,[l("label",re,a(t.$t("cardForm.type")),1),d(l("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>e.type=s),required:"",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},[(n(!0),r(p,null,b(m(z),s=>(n(),r("option",{key:s,value:s},a(s),9,ne))),128))],512),[[x,e.type]])]),l("div",null,[l("label",de,a(t.$t("cardForm.status")),1),d(l("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>e.status=s),required:"",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},[(n(!0),r(p,null,b(m(G),s=>(n(),r("option",{key:s.value,value:s.value},a(t.$t("status."+s.value)),9,ie))),128))],512),[[x,e.status]])]),l("div",null,[l("label",ue,a(t.$t("cardForm.pointsType")),1),d(l("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>e.pointsType=s),required:"",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},[(n(!0),r(p,null,b(m(H),s=>(n(),r("option",{key:s,value:s},a(m(Q)(s)),9,me))),128))],512),[[x,e.pointsType]])]),l("div",null,[l("label",pe,a(t.$t("cardForm.bank")),1),d(l("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>e.bank=s),required:"",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},[(n(!0),r(p,null,b(m(J),s=>(n(),r("option",{key:s,value:s},a(s),9,be))),128))],512),[[x,e.bank]])])])]),l("div",ce,[o[17]||(o[17]=l("h2",{class:"mb-4 text-sm font-semibold text-slate-900"},"Montants",-1)),l("div",fe,[l("div",null,[l("label",ye,a(t.$t("cardForm.lineOfCredit")),1),d(l("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>e.lineOfCredit=s),type:"number",min:"0",step:"1",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.lineOfCredit,void 0,{number:!0}]])]),l("div",null,[l("label",ge,a(t.$t("cardForm.annualCost")),1),d(l("input",{"onUpdate:modelValue":o[6]||(o[6]=s=>e.annualCost=s),type:"number",min:"0",step:"1",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.annualCost,void 0,{number:!0}]])]),l("div",null,[l("label",ve,a(t.$t("cardForm.pointsValue")),1),d(l("input",{"onUpdate:modelValue":o[7]||(o[7]=s=>e.pointsValue=s),type:"number",min:"0",step:"1",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.pointsValue,void 0,{number:!0}]])]),l("div",null,[l("label",xe,a(t.$t("cardForm.expenses")),1),d(l("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>e.expenses=s),type:"number",min:"0",step:"1",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.expenses,void 0,{number:!0}]])]),l("div",null,[l("label",he,a(t.$t("cardForm.progression")),1),d(l("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>e.progression=s),type:"number",min:"0",max:"100",step:"0.01",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.progression,void 0,{number:!0}]])])])]),l("div",we,[o[18]||(o[18]=l("h2",{class:"mb-4 text-sm font-semibold text-slate-900"},"Dates",-1)),l("div",ke,[l("div",null,[l("label",Ce,a(t.$t("cardForm.openDate")),1),d(l("input",{"onUpdate:modelValue":o[10]||(o[10]=s=>e.openDate=s),type:"date",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.openDate]])]),l("div",null,[l("label",De,a(t.$t("cardForm.closeDate")),1),d(l("input",{"onUpdate:modelValue":o[11]||(o[11]=s=>e.closeDate=s),type:"date",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.closeDate]])]),l("div",null,[l("label",Fe,a(t.$t("cardForm.possibleReopenDate")),1),d(l("input",{"onUpdate:modelValue":o[12]||(o[12]=s=>e.possibleReopenDate=s),type:"date",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.possibleReopenDate]])]),l("div",null,[l("label",$e,a(t.$t("cardForm.deadline")),1),d(l("input",{"onUpdate:modelValue":o[13]||(o[13]=s=>e.deadline=s),type:"date",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.deadline]])])])]),l("div",Ve,[l("label",_e,a(t.$t("cardForm.pointsDetails")),1),d(l("textarea",{"onUpdate:modelValue":o[14]||(o[14]=s=>e.pointsDetails=s),rows:"3",class:"block w-full rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[u,e.pointsDetails]])]),l("div",Te,[l("button",{type:"button",class:"rounded-md bg-white px-4 py-2 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50",onClick:o[15]||(o[15]=s=>t.$router.push("/"))},a(t.$t("cardForm.cancel")),1),l("button",{type:"submit",class:"rounded-md bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 disabled:opacity-50",disabled:h.value},a(m(i)?t.$t("cardForm.update"):t.$t("cardForm.create")),9,Ue)])],32)),m(i)?C("",!0):(n(),r("div",Se,[l("h2",Ne,a(t.$t("cardForm.importFromMilesopedia")),1),l("p",Me,a(t.$t("cardForm.importIntro")),1),l("button",{type:"button",class:"rounded-md bg-white px-4 py-2 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50 disabled:opacity-50",disabled:y.value,onClick:U},a(y.value?t.$t("cardForm.fetching"):t.$t("cardForm.fetchFromMilesopedia")),9,Re),v.value.length?(n(),r("div",Oe,[l("p",Ae,a(t.$t("cardForm.selectCardToPrefill")),1),l("ul",qe,[(n(!0),r(p,null,b(v.value,s=>(n(),r("li",{key:s.milesopediaSlug},[l("button",{type:"button",class:"text-left text-sm font-medium text-primary-600 hover:text-primary-700 hover:underline",onClick:Be=>S(s)},a(s.cardName)+" ("+a(s.bank)+", "+a(s.type)+") â€“ "+a(s.annualCost!=null?`$${s.annualCost}`:"?")+" "+a(t.$t("cardForm.annual")),9,Pe)]))),128))])])):C("",!0)]))]))}};export{Le as default};
