import{u as I,x as M,o as T,c as p,a as e,e as $,f as V,d as b,t as s,b as o,F as f,y as E,g as k,h as F,w as y,q as _,r as j,k as A,i as x,j as L,s as O,m as i}from"./index-DSVxf6YR.js";import{b as R,f as W,h as z,i as G}from"./client-Q6rv365W.js";const H={class:"mb-6 flex flex-wrap items-center gap-4"},J={class:"text-2xl font-semibold text-slate-900"},K={key:0,class:"mb-4 text-sm text-red-600"},P={class:"mb-6 rounded-xl bg-white p-6 shadow-sm ring-1 ring-slate-200"},Q={class:"mb-4 text-lg font-semibold text-slate-900"},X={class:"mb-1 block text-sm font-medium text-slate-700"},Y={class:"mb-1 block text-sm font-medium text-slate-700"},Z={class:"mb-1 block text-sm font-medium text-slate-700"},ee={class:"mb-1 block text-sm font-medium text-slate-700"},te=["disabled"],se={class:"rounded-xl bg-white shadow-sm ring-1 ring-slate-200"},ae={class:"border-b border-slate-200 px-6 py-4 text-lg font-semibold text-slate-900"},oe={key:0,class:"p-6 text-slate-600"},ne={key:1,class:"overflow-x-auto"},le={class:"min-w-full divide-y divide-slate-200"},re={class:"bg-slate-50"},de={scope:"col",class:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-600"},ie={scope:"col",class:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-600"},pe={scope:"col",class:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-600"},ce={scope:"col",class:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-600"},ue={class:"divide-y divide-slate-200 bg-white"},me={class:"whitespace-nowrap px-4 py-3 text-sm text-slate-700"},xe={class:"whitespace-nowrap px-4 py-3 text-sm text-slate-700"},he={class:"whitespace-nowrap px-4 py-3 text-sm text-slate-700"},be={class:"px-4 py-3 text-sm text-slate-700"},fe={class:"whitespace-nowrap px-4 py-3"},ye=["onClick"],_e={key:2,class:"p-6 text-slate-600"},ke={__name:"CardSnapshots",props:{id:String},setup(D){const{t:a}=I(),C=D,N=O(),u=L(()=>C.id||N.params.id),c=x(null),m=x(null),h=x(!0),v=x([]),w=x(!1),l=M({weekStartDate:S(),pointsValue:0,expenses:null,notes:null});function S(){const r=new Date,t=r.getDay(),d=r.getDate()-t+(t===0?-6:1);return r.setDate(d),r.toISOString().slice(0,10)}async function B(){var r,t;if(u.value){m.value=null;try{c.value=await R(u.value)}catch(d){m.value=((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.error)||d.message}}}async function g(){var r,t;if(u.value){h.value=!0;try{v.value=await W(u.value)}catch(d){m.value=((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.error)||d.message}finally{h.value=!1}}}async function U(){var r,t;w.value=!0;try{await z(u.value,{weekStartDate:l.weekStartDate,pointsValue:l.pointsValue,expenses:l.expenses??void 0,notes:l.notes||void 0}),l.weekStartDate=S(),l.pointsValue=0,l.expenses=null,l.notes=null,await g()}catch(d){alert(((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.error)||d.message)}finally{w.value=!1}}async function q(r){var t,d;if(confirm(a("snapshots.deleteConfirm")))try{await G(r.id),await g()}catch(n){alert(((d=(t=n.response)==null?void 0:t.data)==null?void 0:d.error)||n.message)}}return T(async()=>{await B(),await g()}),(r,t)=>{const d=A("router-link");return i(),p("div",null,[e("div",H,[$(d,{to:"/",class:"text-sm font-medium text-primary-600 hover:text-primary-700"},{default:V(()=>[b("← "+s(o(a)("snapshots.backToCards")),1)]),_:1}),e("h1",J,[c.value?(i(),p(f,{key:0},[b(s(c.value.cardName)+" – "+s(o(a)("snapshots.title")),1)],64)):(i(),p(f,{key:1},[b(s(o(a)("snapshots.titleShort")),1)],64))]),c.value?(i(),E(d,{key:0,to:`/cards/${c.value.id}`,class:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-slate-700 ring-1 ring-slate-300 hover:bg-slate-50"},{default:V(()=>[b(s(o(a)("snapshots.editCard")),1)]),_:1},8,["to"])):k("",!0)]),m.value?(i(),p("p",K,s(m.value),1)):c.value?(i(),p(f,{key:1},[e("div",P,[e("h2",Q,s(o(a)("snapshots.addSnapshot")),1),e("form",{onSubmit:F(U,["prevent"]),class:"flex flex-wrap items-end gap-4"},[e("div",null,[e("label",X,s(o(a)("snapshots.weekStart")),1),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>l.weekStartDate=n),type:"date",required:"",class:"block rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[_,l.weekStartDate]])]),e("div",null,[e("label",Y,s(o(a)("snapshots.pointsValue")),1),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.pointsValue=n),type:"number",min:"0",required:"",class:"block w-24 rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[_,l.pointsValue,void 0,{number:!0}]])]),e("div",null,[e("label",Z,s(o(a)("snapshots.expenses")),1),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>l.expenses=n),type:"number",min:"0",class:"block w-24 rounded-md border border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[_,l.expenses,void 0,{number:!0}]])]),e("div",null,[e("label",ee,s(o(a)("snapshots.notes")),1),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l.notes=n),type:"text",class:"block w-48 rounded-md border-slate-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"},null,512),[[_,l.notes]])]),e("button",{type:"submit",class:"rounded-md bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 disabled:opacity-50",disabled:w.value},s(o(a)("snapshots.add")),9,te)],32)]),e("div",se,[e("h2",ae,s(o(a)("snapshots.history")),1),h.value?(i(),p("p",oe,s(o(a)("snapshots.loading")),1)):(i(),p("div",ne,[e("table",le,[e("thead",re,[e("tr",null,[e("th",de,s(o(a)("snapshots.weekStartCol")),1),e("th",ie,s(o(a)("snapshots.pointsValue")),1),e("th",pe,s(o(a)("snapshots.expenses")),1),e("th",ce,s(o(a)("snapshots.notes")),1),t[4]||(t[4]=e("th",{scope:"col",class:"relative px-4 py-3"},[e("span",{class:"sr-only"},"Actions")],-1))])]),e("tbody",ue,[(i(!0),p(f,null,j(v.value,n=>(i(),p("tr",{key:n.id,class:"hover:bg-slate-50/50"},[e("td",me,s(n.weekStartDate),1),e("td",xe,s(n.pointsValue),1),e("td",he,s(n.expenses??"–"),1),e("td",be,s(n.notes||"–"),1),e("td",fe,[e("button",{type:"button",class:"text-sm font-medium text-red-600 hover:text-red-700",onClick:ve=>q(n)},s(o(a)("snapshots.delete")),9,ye)])]))),128))])])])),!h.value&&v.value.length===0?(i(),p("p",_e,s(o(a)("snapshots.noSnapshots")),1)):k("",!0)])],64)):k("",!0)])}}};export{ke as default};
